# 回测系统优化记录

## 1. 数据加载年份区间修正
在 `load_parquet_by_years` 函数中，原先使用的 `range(start_year, end_year)` 会漏掉结束年份的数据。已修正为 `range(start_year, end_year + 1)`。

## 2. 交易过滤逻辑优化（信号与交易分离）
针对“T日计算因子，T+1日调仓”的单因子回测需求，我们讨论并确定了以下设计原则：
- **避免前瞻性偏差**：不再直接在 T 日剔除涨跌停股票，以免丢失重要的因子样本。
- **状态标记法**：将 `filter_universe` 重构为生成 `can_buy` 和 `can_sell` 标签。
    - `can_buy`: 剔除 ST、停牌、封死涨停（T+1日买入受限）。
    - `can_sell`: 剔除 ST、停牌、封死跌停（T+1日卖出受限）。
- **执行逻辑**：因子计算函数保持纯净，具体的交易约束（如 T+1 能否买入）交给专门的调仓函数处理。

## 3. 待办事项
- [x] 修复 `range` bug。
- [ ] 完成 `filter_universe` 向状态标记函数的重构。
- [ ] 实现基于 T+1 交易标签的调仓逻辑。
